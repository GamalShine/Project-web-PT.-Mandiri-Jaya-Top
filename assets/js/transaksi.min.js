// Fungsi untuk mendapatkan jumlah hari dalam bulan saat ini
function getDays() {
    let currentDate = new Date();
    let month = currentDate.getMonth() + 1; // Bulan berjalan (dari 0 ke 11)
    let year = currentDate.getFullYear(); // Tahun berjalan
    let daysInMonth = new Date(year, month, 0).getDate(); // Jumlah hari dalam bulan berjalan
    let days = [];
    for (let i = 1; i <= daysInMonth; i++) { // Mulai dari 1 hingga jumlah hari
        days.push(i);
    }
    return days;
}

// Mendapatkan total transaksi hari ini
$.ajax({
    url: transaksi_hariUrl,
    type: "get",
    dataType: "json",
    success: response => {
        $("#transaksi_hari").html(response.total);
    },
    error: error => {
        console.log(error);
    }
});

// Mendapatkan transaksi terakhir
$.ajax({
    url: transaksi_terakhirUrl,
    type: "get",
    dataType: "json",
    success: response => {
        $("#transaksi_terakhir").html(response);
    },
    error: error => {
        console.log(error);
    }
});

// Mendapatkan stok hari ini
$.ajax({
    url: stok_hariUrl,
    type: "get",
    dataType: "json",
    success: response => {
        $("#stok_hari").html(response.total);
    },
    error: error => {
        console.log(error);
    }
});

// Mendapatkan produk terlaris dan menampilkan dalam bentuk chart
$.ajax({
    url: produk_terlarisUrl,
    type: "get",
    dataType: "json",
    success: response => {
        let ctx = $("#produkTerlaris").get(0).getContext("2d");
        new Chart(ctx, {
            type: "pie",
            data: {
                labels: response.label,
                datasets: [{
                    backgroundColor: ["#f56954", "#00a65a", "#f39c12", "#00c0ef", "#3c8dbc", "#d2d6de"],
                    data: response.data
                }]
            },
            options: {
                maintainAspectRatio: false,
                responsive: true
            }
        });
    },
    error: error => {
        console.log(error);
    }
});

// Mendapatkan data stok dan menampilkan dalam daftar
$.ajax({
    url: data_stokUrl,
    type: "get",
    dataType: "json",
    success: response => {
        $.each(response, (index, item) => {
            let listItem = `
                <li class="list-group-item">
                    ${item.nama_produk}
                    <span class="float-right">${item.stok}</span>
                </li>`;
            $("#stok_produk").append(listItem);
        });
    },
    error: error => {
        console.log(error);
    }
});

// Mendapatkan penjualan bulan ini dan menampilkan dalam bentuk chart
$.ajax({
    url: penjualan_bulanUrl,
    type: "post",
    data: { day: getDays() },
    dataType: "json",
    success: response => {
        let ctx = $("#bulanIni").get(0).getContext("2d");
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: getDays(),
                datasets: [{
                    label: "Total",
                    backgroundColor: "rgba(60,141,188,0.9)",
                    borderColor: "rgba(60,141,188,0.8)",
                    pointRadius: false,
                    pointColor: "#3b8bba",
                    pointStrokeColor: "rgba(60,141,188,1)",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(60,141,188,1)",
                    data: response
                }]
            },
            options: {
                maintainAspectRatio: false,
                responsive: true,
                legend: { display: false },
                scales: {
                    xAxes: [{ gridLines: { display: false } }],
                    yAxes: [{ gridLines: { display: false } }]
                }
            }
        });
    },
    error: error => {
        console.log(error);
    }
});
